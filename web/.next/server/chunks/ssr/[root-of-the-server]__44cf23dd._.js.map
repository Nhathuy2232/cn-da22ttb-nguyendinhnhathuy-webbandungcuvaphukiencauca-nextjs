{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/XAMPP/htdocs/DOAN_CN_E-COMMERCE/web/src/lib/api-client.ts"],"sourcesContent":["const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4000/api';\r\n\r\ninterface RequestConfig extends RequestInit {\r\n  requiresAuth?: boolean;\r\n}\r\n\r\nclass ApiClient {\r\n  private baseUrl: string;\r\n\r\n  constructor(baseUrl: string) {\r\n    this.baseUrl = baseUrl;\r\n  }\r\n\r\n  private getAuthToken(): string | null {\r\n    if (typeof window === 'undefined') return null;\r\n    return localStorage.getItem('accessToken');\r\n  }\r\n\r\n  private async request<T>(\r\n    endpoint: string,\r\n    config: RequestConfig = {}\r\n  ): Promise<T> {\r\n    const { requiresAuth = false, headers = {}, ...restConfig } = config;\r\n\r\n    const requestHeaders: Record<string, string> = {\r\n      'Content-Type': 'application/json',\r\n      ...(headers as Record<string, string>),\r\n    };\r\n\r\n    if (requiresAuth) {\r\n      const token = this.getAuthToken();\r\n      if (token) {\r\n        requestHeaders['Authorization'] = `Bearer ${token}`;\r\n      }\r\n    }\r\n\r\n    const response = await fetch(`${this.baseUrl}${endpoint}`, {\r\n      ...restConfig,\r\n      headers: requestHeaders,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({\r\n        success: false,\r\n        message: 'An error occurred',\r\n      }));\r\n      \r\n      // Nếu là lỗi 401 (unauthorized), có thể xóa token\r\n      if (response.status === 401 && typeof window !== 'undefined') {\r\n        localStorage.removeItem('accessToken');\r\n      }\r\n      \r\n      throw new Error(error.message || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  // Các endpoint xác thực\r\n  async register(data: {\r\n    full_name: string;\r\n    email: string;\r\n    password: string;\r\n  }) {\r\n    return this.request('/auth/register', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n  }\r\n\r\n  async login(data: { email: string; password: string }) {\r\n    const response = await this.request<any>('/auth/login', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n    });\r\n    \r\n    if (response.data?.accessToken) {\r\n      localStorage.setItem('accessToken', response.data.accessToken);\r\n    }\r\n    \r\n    return response;\r\n  }\r\n\r\n  async logout() {\r\n    const response = await this.request('/auth/logout', {\r\n      method: 'POST',\r\n      requiresAuth: true,\r\n    });\r\n    \r\n    localStorage.removeItem('accessToken');\r\n    return response;\r\n  }\r\n\r\n  async getMe() {\r\n    return this.request('/auth/me', {\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  // Các endpoint sản phẩm\r\n  async getProducts(params?: {\r\n    search?: string;\r\n    category?: string;\r\n    page?: number;\r\n    limit?: number;\r\n  }) {\r\n    const queryParams = new URLSearchParams();\r\n    if (params?.search) queryParams.set('search', params.search);\r\n    if (params?.category) queryParams.set('category', params.category);\r\n    if (params?.page) queryParams.set('page', params.page.toString());\r\n    if (params?.limit) queryParams.set('limit', params.limit.toString());\r\n\r\n    const query = queryParams.toString();\r\n    return this.request(`/products${query ? `?${query}` : ''}`);\r\n  }\r\n\r\n  async getProduct(id: number) {\r\n    return this.request(`/products/${id}`);\r\n  }\r\n\r\n  // Các endpoint danh mục\r\n  async getCategories() {\r\n    return this.request('/categories');\r\n  }\r\n\r\n  async getCategory(id: number) {\r\n    return this.request(`/categories/${id}`);\r\n  }\r\n\r\n  // Các endpoint giỏ hàng\r\n  async getCart() {\r\n    return this.request('/cart', {\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  async addToCart(data: { product_id: number; quantity: number }) {\r\n    return this.request('/cart', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  async updateCartItem(productId: number, quantity: number) {\r\n    return this.request(`/cart`, {\r\n      method: 'PUT',\r\n      body: JSON.stringify({ product_id: productId, quantity }),\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  async removeCartItem(id: number) {\r\n    return this.request(`/cart/${id}`, {\r\n      method: 'DELETE',\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  async clearCart() {\r\n    return this.request('/cart', {\r\n      method: 'DELETE',\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  // Các endpoint đơn hàng\r\n  async createOrder(data: {\r\n    address_id: number;\r\n    payment_method: 'cod' | 'bank_transfer' | 'e_wallet';\r\n    note?: string;\r\n  }) {\r\n    return this.request('/orders', {\r\n      method: 'POST',\r\n      body: JSON.stringify(data),\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  async getOrders() {\r\n    return this.request('/orders', {\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n\r\n  async getOrder(id: number) {\r\n    return this.request(`/orders/${id}`, {\r\n      requiresAuth: true,\r\n    });\r\n  }\r\n}\r\n\r\nexport const apiClient = new ApiClient(API_BASE_URL);\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///D:/XAMPP/htdocs/DOAN_CN_E-COMMERCE/web/src/hooks/useAuth.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { apiClient } from '@/lib/api-client';\r\n\r\ninterface User {\r\n  id: number;\r\n  fullName: string;\r\n  email: string;\r\n  role: 'customer' | 'admin';\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  loading: boolean;\r\n  login: (email: string, password: string) => Promise<void>;\r\n  register: (fullName: string, email: string, password: string) => Promise<void>;\r\n  logout: () => Promise<void>;\r\n  isAuthenticated: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    async function loadUser() {\r\n      try {\r\n        const token = localStorage.getItem('accessToken');\r\n        if (token) {\r\n          const response = await apiClient.getMe() as any;\r\n          if (response.success) {\r\n            setUser(response.data);\r\n          } else {\r\n            // Token không hợp lệ, xóa nó\r\n            localStorage.removeItem('accessToken');\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Token hết hạn hoặc không hợp lệ, xóa nó một cách im lặng\r\n        console.log('Token đã hết hạn hoặc không hợp lệ');\r\n        localStorage.removeItem('accessToken');\r\n        setUser(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    loadUser();\r\n  }, []);\r\n\r\n  const login = async (email: string, password: string) => {\r\n    try {\r\n      const response = await apiClient.login({ email, password }) as any;\r\n      if (response.success) {\r\n        setUser(response.data.user);\r\n      }\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const register = async (fullName: string, email: string, password: string) => {\r\n    try {\r\n      const response = await apiClient.register({\r\n        full_name: fullName,\r\n        email,\r\n        password,\r\n      }) as any;\r\n      if (response.success) {\r\n        setUser(response.data.user);\r\n      }\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await apiClient.logout();\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      setUser(null);\r\n      localStorage.removeItem('accessToken');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        loading,\r\n        login,\r\n        register,\r\n        logout,\r\n        isAuthenticated: !!user,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAqBA,MAAM,4BAAc,IAAA,sNAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,eAAe;YACb,IAAI;gBACF,MAAM,QAAQ,aAAa,OAAO,CAAC;gBACnC,IAAI,OAAO;oBACT,MAAM,WAAW,MAAM,wIAAS,CAAC,KAAK;oBACtC,IAAI,SAAS,OAAO,EAAE;wBACpB,QAAQ,SAAS,IAAI;oBACvB,OAAO;wBACL,6BAA6B;wBAC7B,aAAa,UAAU,CAAC;oBAC1B;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,2DAA2D;gBAC3D,QAAQ,GAAG,CAAC;gBACZ,aAAa,UAAU,CAAC;gBACxB,QAAQ;YACV,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG,EAAE;IAEL,MAAM,QAAQ,OAAO,OAAe;QAClC,IAAI;YACF,MAAM,WAAW,MAAM,wIAAS,CAAC,KAAK,CAAC;gBAAE;gBAAO;YAAS;YACzD,IAAI,SAAS,OAAO,EAAE;gBACpB,QAAQ,SAAS,IAAI,CAAC,IAAI;YAC5B;QACF,EAAE,OAAO,OAAO;YACd,MAAM;QACR;IACF;IAEA,MAAM,WAAW,OAAO,UAAkB,OAAe;QACvD,IAAI;YACF,MAAM,WAAW,MAAM,wIAAS,CAAC,QAAQ,CAAC;gBACxC,WAAW;gBACX;gBACA;YACF;YACA,IAAI,SAAS,OAAO,EAAE;gBACpB,QAAQ,SAAS,IAAI,CAAC,IAAI;YAC5B;QACF,EAAE,OAAO,OAAO;YACd,MAAM;QACR;IACF;IAEA,MAAM,SAAS;QACb,IAAI;YACF,MAAM,wIAAS,CAAC,MAAM;QACxB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;QACjC,SAAU;YACR,QAAQ;YACR,aAAa,UAAU,CAAC;QAC1B;IACF;IAEA,qBACE,8OAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;YACA,iBAAiB,CAAC,CAAC;QACrB;kBAEC;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}}]
}