(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{228:(e,t,a)=>{"use strict";function s(e){return Math.round("string"==typeof e?parseFloat(e):e).toLocaleString("vi-VN")+"₫"}a.d(t,{$:()=>s})},1360:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},1761:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},1873:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},6191:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6398:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])},6617:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},6767:(e,t,a)=>{Promise.resolve().then(a.bind(a,6926))},6926:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var s=a(5155),n=a(2115),r=a(63),l=a(1398),c=a(4693),i=a(6617),o=a(7125),d=a(6191),h=a(1360),u=a(1873),g=a(6398),m=a(1761),p=a(9300),x=a(228);function y(){let e=(0,r.useRouter)(),{user:t,loading:a}=(0,p.A)(),[y,b]=(0,n.useState)([]),[f,j]=(0,n.useState)(!0),[v,N]=(0,n.useState)([]),[w,k]=(0,n.useState)([]),[C,A]=(0,n.useState)([]),[S,T]=(0,n.useState)(0),[_,E]=(0,n.useState)(0),[q,D]=(0,n.useState)(""),[V,M]=(0,n.useState)(""),[P,H]=(0,n.useState)(""),[I,L]=(0,n.useState)(""),[B,O]=(0,n.useState)(""),[z,K]=(0,n.useState)(null),[W,$]=(0,n.useState)(!1),[G,X]=(0,n.useState)(!1),[F,J]=(0,n.useState)("cod");(0,n.useEffect)(()=>{if(!a){if(!t)return void e.push("/login?redirect=/cart");Q(),R()}},[t,a,e]),(0,n.useEffect)(()=>{S>0&&(U(S),E(0),D(""),K(null))},[S]),(0,n.useEffect)(()=>{_>0&&(Y(_),D(""),K(null))},[_]),(0,n.useEffect)(()=>{_>0&&q&&y.length>0&&Z()},[_,q,y]);let Q=async()=>{try{let t=localStorage.getItem("accessToken"),a=await fetch("http://localhost:4000/api/cart",{headers:{Authorization:"Bearer ".concat(t)}});if(a.ok){var e;let t=await a.json();b((null==(e=t.data)?void 0:e.items)||[])}}catch(e){console.error("Error fetching cart:",e)}finally{j(!1)}},R=async()=>{try{let e=await fetch("http://localhost:4000/api/shipping/provinces");if(e.ok){let t=await e.json();N(t.data||[])}}catch(e){console.error("Error fetching provinces:",e)}},U=async e=>{try{let t=await fetch("http://localhost:4000/api/shipping/districts/".concat(e));if(t.ok){let e=await t.json();k(e.data||[])}}catch(e){console.error("Error fetching districts:",e)}},Y=async e=>{try{let t=await fetch("http://localhost:4000/api/shipping/wards/".concat(e));if(t.ok){let e=await t.json();A(e.data||[])}}catch(e){console.error("Error fetching wards:",e)}},Z=async()=>{console.log("\uD83D\uDE9A Bắt đầu t\xednh ph\xed vận chuyển..."),console.log("- selectedDistrict:",_),console.log("- selectedWard:",q),console.log("- cartItems.length:",y.length),$(!0);try{let e=y.reduce((e,t)=>e+500*t.quantity,0),t=y.reduce((e,t)=>e+t.product_price*t.quantity,0);console.log("- totalWeight:",e),console.log("- totalValue:",t);let a={toDistrictId:_,toWardCode:q,weight:e,insuranceValue:t};console.log("\uD83D\uDCE4 Sending request:",a);let s=await fetch("http://localhost:4000/api/shipping/calculate-fee",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(console.log("\uD83D\uDCE5 Response status:",s.status),s.ok){let e=await s.json();console.log("\uD83D\uDCE5 Response data:",e),e.success&&e.data?(K(e.data),console.log("✅ T\xednh ph\xed th\xe0nh c\xf4ng:",e.data.total)):(console.error("❌ Lỗi t\xednh ph\xed vận chuyển:",e.message),alert("Kh\xf4ng thể t\xednh ph\xed vận chuyển: "+(e.message||"Lỗi kh\xf4ng x\xe1c định")),K(null))}else{let e=await s.json().catch(()=>({}));console.error("❌ Lỗi t\xednh ph\xed vận chuyển:",e.message||"Kh\xf4ng thể t\xednh ph\xed"),alert("Kh\xf4ng thể t\xednh ph\xed vận chuyển: "+(e.message||"Vui l\xf2ng kiểm tra lại th\xf4ng tin địa chỉ")),K(null)}}catch(e){console.error("❌ Error calculating shipping fee:",e),alert("Lỗi kết nối: "+e)}finally{$(!1)}},ee=async(e,t)=>{if(!(t<1))try{let a=localStorage.getItem("accessToken");(await fetch("http://localhost:4000/api/cart",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({itemId:e,quantity:t})})).ok&&Q()}catch(e){console.error("Error updating quantity:",e)}},et=async e=>{try{let t=localStorage.getItem("accessToken");(await fetch("http://localhost:4000/api/cart/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).ok&&Q()}catch(e){console.error("Error removing item:",e)}},ea=async()=>{if(!V)return void alert("Vui l\xf2ng nhập họ v\xe0 t\xean người nhận");if(!P)return void alert("Vui l\xf2ng nhập số điện thoại người nhận");if(!S)return void alert("Vui l\xf2ng chọn Tỉnh/Th\xe0nh phố");if(!_)return void alert("Vui l\xf2ng chọn Quận/Huyện");if(!q)return void alert("Vui l\xf2ng chọn Phường/X\xe3");if(!I)return void alert("Vui l\xf2ng nhập địa chỉ cụ thể");if(!F)return void alert("Vui l\xf2ng chọn phương thức thanh to\xe1n");X(!0);try{let a=localStorage.getItem("accessToken"),s=null==t?void 0:t.id;if(!s){alert("Kh\xf4ng x\xe1c định được người d\xf9ng. Vui l\xf2ng đăng nhập lại."),X(!1);return}let n={userId:s,payment_method:F,note:B,shipping_info:{recipient_name:V,recipient_phone:P,address:I,province_id:S,district_id:_,ward_code:q},shipping_fee:(null==z?void 0:z.total)||0,items:y.map(e=>({product_id:e.product_id,quantity:e.quantity,price:e.product_price}))},r=await fetch("http://localhost:4000/api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(n)});if(r.ok){let t=await r.json();t.success?(alert("Đặt h\xe0ng th\xe0nh c\xf4ng! M\xe3 đơn h\xe0ng: "+t.data.id),await fetch("http://localhost:4000/api/cart",{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}}),e.push("/")):alert("Lỗi: "+(t.message||"Kh\xf4ng thể tạo đơn h\xe0ng"))}else{let e=await r.json().catch(()=>({}));alert("Lỗi: "+(e.message||"Kh\xf4ng thể tạo đơn h\xe0ng"))}}catch(e){console.error("Error creating order:",e),alert("C\xf3 lỗi xảy ra khi đặt h\xe0ng")}finally{X(!1)}},es=y.reduce((e,t)=>e+t.product_price*t.quantity,0),en=es+((null==z?void 0:z.total)||0);return a||f?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"})}):(0,s.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[(0,s.jsx)(l.Header,{}),(0,s.jsxs)("main",{className:"flex-1 container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Giỏ h\xe0ng của bạn"}),0===y.length?(0,s.jsxs)("div",{className:"text-center py-16 bg-white rounded-xl shadow-sm",children:[(0,s.jsx)(i.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Giỏ h\xe0ng trống"}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:"H\xe3y th\xeam sản phẩm v\xe0o giỏ h\xe0ng để tiếp tục mua sắm"}),(0,s.jsx)("button",{onClick:()=>e.push("/products"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Tiếp tục mua sắm"})]}):(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-2 space-y-4",children:y.map(e=>(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("img",{src:e.product_thumbnail||"/images/products/placeholder.jpg",alt:e.product_name,className:"w-24 h-24 object-cover rounded-lg"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.product_name}),(0,s.jsx)("p",{className:"text-blue-600 font-bold text-xl mb-4",children:(0,x.$)(e.product_price)}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border border-gray-300 rounded-lg",children:[(0,s.jsx)("button",{onClick:()=>ee(e.id,e.quantity-1),className:"p-2 hover:bg-gray-100 rounded-l-lg",disabled:e.quantity<=1,children:(0,s.jsx)(o.A,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"px-4 font-semibold",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>ee(e.id,e.quantity+1),className:"p-2 hover:bg-gray-100 rounded-r-lg",disabled:e.quantity>=e.stock_quantity,children:(0,s.jsx)(d.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("button",{onClick:()=>et(e.id),className:"text-red-600 hover:text-red-700 flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"w-5 h-5"}),"X\xf3a"]})]})]})]})},e.id))}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"w-5 h-5 text-blue-600"}),"Th\xf4ng tin giao h\xe0ng"]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Họ v\xe0 t\xean"}),(0,s.jsx)("input",{type:"text",value:V,onChange:e=>M(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nguyễn Văn A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Số điện thoại"}),(0,s.jsx)("input",{type:"tel",value:P,onChange:e=>H(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0901234567"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tỉnh/Th\xe0nh phố"}),(0,s.jsxs)("select",{value:S,onChange:e=>T(Number(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:0,children:"Chọn Tỉnh/Th\xe0nh phố"}),v.map(e=>(0,s.jsx)("option",{value:e.ProvinceID,children:e.ProvinceName},e.ProvinceID))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quận/Huyện"}),(0,s.jsxs)("select",{value:_,onChange:e=>E(Number(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!S,children:[(0,s.jsx)("option",{value:0,children:"Chọn Quận/Huyện"}),w.map(e=>(0,s.jsx)("option",{value:e.DistrictID,children:e.DistrictName},e.DistrictID))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phường/X\xe3"}),(0,s.jsxs)("select",{value:q,onChange:e=>D(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!_,children:[(0,s.jsx)("option",{value:"",children:"Chọn Phường/X\xe3"}),C.map(e=>(0,s.jsx)("option",{value:e.WardCode,children:e.WardName},e.WardCode))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Địa chỉ cụ thể"}),(0,s.jsx)("input",{type:"text",value:I,onChange:e=>L(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Số nh\xe0, t\xean đường..."})]}),_>0&&q&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{type:"button",onClick:Z,disabled:W,className:"w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 font-medium flex items-center justify-center gap-2",children:[(0,s.jsx)(g.A,{className:"w-5 h-5"}),W?"Đang t\xednh ph\xed...":"T\xednh ph\xed vận chuyển"]}),z&&(0,s.jsx)("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-green-800 font-medium",children:["✅ Ph\xed vận chuyển: ",(0,x.$)(z.total)]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phương thức thanh to\xe1n"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 transition-colors",children:[(0,s.jsx)("input",{type:"radio",name:"payment_method",value:"cod",checked:"cod"===F,onChange:e=>J(e.target.value),className:"w-4 h-4 text-blue-600"}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:"\uD83D\uDCB5 Thanh to\xe1n khi nhận h\xe0ng (COD)"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Thanh to\xe1n bằng tiền mặt khi nhận h\xe0ng"})]})]}),(0,s.jsxs)("div",{className:"flex items-center p-4 border border-gray-200 rounded-lg bg-gray-50 opacity-60 cursor-not-allowed",children:[(0,s.jsx)("input",{type:"radio",name:"payment_method",value:"bank_transfer",disabled:!0,className:"w-4 h-4 text-gray-400"}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-500",children:"\uD83C\uDFE6 Chuyển khoản ng\xe2n h\xe0ng"}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"T\xednh năng đang ph\xe1t triển"})]})]}),(0,s.jsxs)("div",{className:"flex items-center p-4 border border-gray-200 rounded-lg bg-gray-50 opacity-60 cursor-not-allowed",children:[(0,s.jsx)("input",{type:"radio",name:"payment_method",value:"e_wallet",disabled:!0,className:"w-4 h-4 text-gray-400"}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-500",children:"\uD83D\uDCF1 V\xed điện tử"}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"T\xednh năng đang ph\xe1t triển"})]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ghi ch\xfa"}),(0,s.jsx)("textarea",{value:B,onChange:e=>O(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Ghi ch\xfa th\xeam cho đơn h\xe0ng..."})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)(m.A,{className:"w-5 h-5 text-blue-600"}),"Tổng cộng"]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,s.jsx)("span",{children:"Tạm t\xednh"}),(0,s.jsx)("span",{children:(0,x.$)(es)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"w-4 h-4"}),"Ph\xed vận chuyển"]}),(0,s.jsx)("span",{children:W?(0,s.jsx)("span",{className:"text-sm",children:"Đang t\xednh..."}):z?(0,x.$)(z.total):(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Chọn địa chỉ"})})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between text-xl font-bold text-gray-900",children:[(0,s.jsx)("span",{children:"Tổng cộng"}),(0,s.jsx)("span",{className:"text-blue-600",children:(0,x.$)(en)})]})})]}),(0,s.jsx)("button",{onClick:ea,disabled:!z||G||!V||!P||!I,className:"w-full mt-6 px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-semibold text-lg transition-colors",children:G?"Đang xử l\xfd...":"Đặt h\xe0ng"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Bằng c\xe1ch đặt h\xe0ng, bạn đồng \xfd với điều khoản sử dụng"})]})]})]})]}),(0,s.jsx)(c.w,{})]})}},7125:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])}},e=>{e.O(0,[619,398,663,441,255,358],()=>e(e.s=6767)),_N_E=e.O()}]);