(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{344:(e,t,r)=>{"use strict";r.d(t,{u:()=>o});let s=r(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:4000/api";class a{getAuthToken(){return localStorage.getItem("accessToken")}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{requiresAuth:r=!1,headers:s={},...a}=t,o={"Content-Type":"application/json",...s};if(r){let e=this.getAuthToken();e&&(o.Authorization="Bearer ".concat(e))}let c=await fetch("".concat(this.baseUrl).concat(e),{...a,headers:o});if(!c.ok){let e=await c.json().catch(()=>({success:!1,message:"An error occurred"}));throw 401===c.status&&localStorage.removeItem("accessToken"),Error(e.message||"HTTP ".concat(c.status))}return c.json()}async register(e){return this.request("/auth/register",{method:"POST",body:JSON.stringify(e)})}async login(e){var t;let r=await this.request("/auth/login",{method:"POST",body:JSON.stringify(e)});return(null==(t=r.data)?void 0:t.accessToken)&&localStorage.setItem("accessToken",r.data.accessToken),r}async logout(){let e=await this.request("/auth/logout",{method:"POST",requiresAuth:!0});return localStorage.removeItem("accessToken"),e}async getMe(){return this.request("/auth/me",{requiresAuth:!0})}async getProducts(e){let t=new URLSearchParams;(null==e?void 0:e.search)&&t.set("search",e.search),(null==e?void 0:e.category)&&t.set("category",e.category),(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString());let r=t.toString();return this.request("/products".concat(r?"?".concat(r):""))}async getProduct(e){return this.request("/products/".concat(e))}async getCategories(){return this.request("/categories")}async getCategory(e){return this.request("/categories/".concat(e))}async getCart(){return this.request("/cart",{requiresAuth:!0})}async addToCart(e){return this.request("/cart",{method:"POST",body:JSON.stringify(e),requiresAuth:!0})}async updateCartItem(e,t){return this.request("/cart",{method:"PUT",body:JSON.stringify({product_id:e,quantity:t}),requiresAuth:!0})}async removeCartItem(e){return this.request("/cart/".concat(e),{method:"DELETE",requiresAuth:!0})}async clearCart(){return this.request("/cart",{method:"DELETE",requiresAuth:!0})}async createOrder(e){return this.request("/orders",{method:"POST",body:JSON.stringify(e),requiresAuth:!0})}async getOrders(){return this.request("/orders",{requiresAuth:!0})}async getOrder(e){return this.request("/orders/".concat(e),{requiresAuth:!0})}constructor(e){this.baseUrl=e}}let o=new a(s)},3673:()=>{},5862:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3673,23)),Promise.resolve().then(r.bind(r,9300))},9300:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,AuthProvider:()=>n});var s=r(5155),a=r(2115),o=r(344);let c=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,a.useState)(null),[u,i]=(0,a.useState)(!0);(0,a.useEffect)(()=>{!async function(){try{if(localStorage.getItem("accessToken")){let e=await o.u.getMe();e.success?n(e.data):localStorage.removeItem("accessToken")}}catch(e){console.log("Token đ\xe3 hết hạn hoặc kh\xf4ng hợp lệ"),localStorage.removeItem("accessToken"),n(null)}finally{i(!1)}}()},[]);let l=async(e,t)=>{try{let r=await o.u.login({email:e,password:t});r.success&&n(r.data.user)}catch(e){throw e}},h=async(e,t,r)=>{try{let s=await o.u.register({full_name:e,email:t,password:r});s.success&&n(s.data.user)}catch(e){throw e}},g=async()=>{try{await o.u.logout()}catch(e){console.error("Logout error:",e)}finally{n(null),localStorage.removeItem("accessToken")}};return(0,s.jsx)(c.Provider,{value:{user:r,loading:u,login:l,register:h,logout:g,isAuthenticated:!!r},children:t})}function u(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[978,441,255,358],()=>e(e.s=5862)),_N_E=e.O()}]);